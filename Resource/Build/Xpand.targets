<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <ExtensionTasksPath Condition="'$(ExtensionTasksPath)' == ''">$(MSBuildProjectDirectory)\..\..\Resource\Build\ExtensionPack\</ExtensionTasksPath>
  </PropertyGroup>
  <Import Project="$(ExtensionTasksPath)\MSBuild.ExtensionPack.tasks" />
  <Target Name="DXComponentsDirectory">
    <MSBuild.ExtensionPack.Framework.MsBuildHelper TaskAction="FilterItems" InputItems1="@(Reference)" RegexPattern="DevExpress.*">
      <Output TaskParameter="OutputItems" ItemName="filtered"/>
    </MSBuild.ExtensionPack.Framework.MsBuildHelper>
    <MSBuild.ExtensionPack.Framework.MsBuildHelper TaskAction="GetLastItem" InputItems1="@(filtered)">
      <Output TaskParameter="OutputItems" ItemName="LastItem"/>
    </MSBuild.ExtensionPack.Framework.MsBuildHelper>
    <PropertyGroup>
      <DXVersion>$([System.Text.RegularExpressions.Regex]::Match(%(LastItem.Identity), `(\d\d\.\d)`))</DXVersion>
    </PropertyGroup>
    <Message Text="DXVersion : $(DXVersion)"/>
    <MSBuild.ExtensionPack.Computer.Registry TaskAction="Get" RegistryHive="LocalMachine" Key="SOFTWARE\Wow6432Node\DevExpress\Components\v$(DXVersion)" Value="RootDirectory">
      <Output PropertyName="DXComponentsDirectory" TaskParameter="Data"/>
    </MSBuild.ExtensionPack.Computer.Registry>
    <Message Text="DXComponentsDirectory : $(DXComponentsDirectory)"/>
  </Target>
  
  <ItemGroup>
    <EasyTestFiles Include="..\..\_third_party_assemblies\Aforge*.dll;..\..\_third_party_assemblies\FFMPEG\*.*"></EasyTestFiles>
    <EasyTestFiles Include="$(TargetPath);$(TargetDir)Xpand.Utils.dll"></EasyTestFiles>
  </ItemGroup>
  <Target Name="UpdateDXEasyTestFolder" DependsOnTargets="DXComponentsDirectory">
    <Message Text="@(EasyTestFiles)"></Message>
    <Copy SkipUnchangedFiles="True" SourceFiles="@(EasyTestFiles)" DestinationFolder="$(DXComponentsDirectory)Tools\eXpressAppFramework\EasyTest"></Copy>
  </Target>
</Project>
